
<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en"><![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie10 lt-ie9" lang="en"><![endif]-->
<!--[if (IE 9)&!(IEMobile)]><html class="no-js lt-ie10" lang="en"><![endif]-->
<!--[if gt IE 9]><!--><!-- x --> <html class="no-js" lang="en"> <!--<![endif]-->

<!-- Mirrored from secure.runescape.com/m=hiscore_oldschool/overall by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 04 Jun 2024 14:21:01 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=ISO-8859-1" /><!-- /Added by HTTrack -->
<head>
<link href="css/rsp777_basic-119.css" rel="stylesheet" type="text/css" media="all">
<script data-cookieconsent="ignore">
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }
    gtag("consent", "default", {
        ad_storage: "denied",
        analytics_storage: "denied",
        functionality_storage: "denied",
        personalization_storage: "denied",
        ad_personalization: "denied",
        ad_user_data: "denied",
        security_storage: "granted",
        wait_for_update: 500,
    });
    gtag("set", "ads_data_redaction", true);
</script>
<script id="Cookiebot" src="../../consent.cookiebot.com/uc.js" data-cbid="9147fcf2-a466-4a5d-82ab-43e528833d80" data-blockingmode="auto"></script>
<script src="js/c/responsive/vendor-151.js" data-cookieconsent="ignore"></script>
<title>Bap Head Hiscores</title>
<meta name="keywords" content="MMORPG, free RPG games online, online multiplayer, role-playing, massively multiplayer games, mmo, RuneScape, Jagex" />
<meta name="description" content="Welcome to the Bap Heads Clan Collection Log Hiscores page! This dedicated page proudly displays the clan Clog rankings and will be updated every sunday." />

<link rel="icon" type="image/vnd.microsoft.icon" href="img/global/favicon.ico" />
<link rel="SHORTCUT ICON" href="img/global/favicon.ico" />
<link rel="apple-touch-icon" href="img/global/mobile.png">
<meta property="fb:app_id" content="174823375888281" />

<meta property="og:title" content="Bap Head Hiscores" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Bap Heads" />
<meta property="og:image" content="img/rsp777/banner.png" />
<meta property="og:url" content="https://bapheads.github.io/Hiscores/" />
<meta property="og:description" content="Welcome to the Bap Heads Clan Collection Log Hiscores page! This dedicated page proudly displays the clan Clog rankings and will be updated every sunday." />
<meta name="google-site-verification" content="RFtGg-G07XweT7nQe032HocvnRPhJAsdZqrq4NX_Op8">
<meta itemprop="name" content="Bap Heads">
<meta itemprop="description" content="Welcome to the Bap Heads Clan Collection Log Hiscores page! This dedicated page proudly displays the clan Clog rankings and will be updated every sunday.">
<link href="css/rsp777_hiscore-119.css" rel="stylesheet" type="text/css" media="all">
<style>
    
        .leaguepoints:before {
            content: url('img/rsp777/game_icon_leaguepointsc81e.png?2');
        }
    
        .deadmanpoints:before {
            content: url('img/rsp777/game_icon_deadmanpointsc81e.png?2');
        }
    
        .bountyhunterhunter:before {
            content: url('img/rsp777/game_icon_bountyhunterhunterc81e.png?2');
        }
    
        .bountyhunterrogue:before {
            content: url('img/rsp777/game_icon_bountyhunterroguec81e.png?2');
        }
    
        .bountyhunterlegacyhunter:before {
            content: url('img/rsp777/game_icon_bountyhunterlegacyhunterc81e.png?2');
        }
    
        .bountyhunterlegacyrogue:before {
            content: url('img/rsp777/game_icon_bountyhunterlegacyroguec81e.png?2');
        }
    
        .cluescrollsall:before {
            content: url('img/rsp777/game_icon_cluescrollsallc81e.png?2');
        }
    
        .cluescrollsbeginner:before {
            content: url('img/rsp777/game_icon_cluescrollsbeginnerc81e.png?2');
        }
    
        .cluescrollseasy:before {
            content: url('img/rsp777/game_icon_cluescrollseasyc81e.png?2');
        }
    
        .cluescrollsmedium:before {
            content: url('img/rsp777/game_icon_cluescrollsmediumc81e.png?2');
        }
    
        .cluescrollshard:before {
            content: url('img/rsp777/game_icon_cluescrollshardc81e.png?2');
        }
    
        .cluescrollselite:before {
            content: url('img/rsp777/game_icon_cluescrollselitec81e.png?2');
        }
    
        .cluescrollsmaster:before {
            content: url('img/rsp777/game_icon_cluescrollsmasterc81e.png?2');
        }
    
        .lmsrank:before {
            content: url('img/rsp777/game_icon_lmsrankc81e.png?2');
        }
    
        .pvparenarank:before {
            content: url('img/rsp777/game_icon_pvparenarankc81e.png?2');
        }
    
        .soulwarszeal:before {
            content: url('img/rsp777/game_icon_soulwarszealc81e.png?2');
        }
    
        .riftsclosed:before {
            content: url('img/rsp777/game_icon_riftsclosedc81e.png?2');
        }
    
        .colosseumglory:before {
            content: url('img/rsp777/game_icon_colosseumgloryc81e.png?2');
        }
    
        .abyssalsire:before {
            content: url('img/rsp777/game_icon_abyssalsirec81e.png?2');
        }
    
        .alchemicalhydra:before {
            content: url('img/rsp777/game_icon_alchemicalhydrac81e.png?2');
        }
    
        .artio:before {
            content: url('img/rsp777/game_icon_artioc81e.png?2');
        }
    
        .barrowschests:before {
            content: url('img/rsp777/game_icon_barrowschestsc81e.png?2');
        }
    
        .bryophyta:before {
            content: url('img/rsp777/game_icon_bryophytac81e.png?2');
        }
    
        .callisto:before {
            content: url('img/rsp777/game_icon_callistoc81e.png?2');
        }
    
        .calvarion:before {
            content: url('img/rsp777/game_icon_calvarionc81e.png?2');
        }
    
        .cerberus:before {
            content: url('img/rsp777/game_icon_cerberusc81e.png?2');
        }
    
        .chambersofxeric:before {
            content: url('img/rsp777/game_icon_chambersofxericc81e.png?2');
        }
    
        .chambersofxericchallengemode:before {
            content: url('img/rsp777/game_icon_chambersofxericchallengemodec81e.png?2');
        }
    
        .chaoselemental:before {
            content: url('img/rsp777/game_icon_chaoselementalc81e.png?2');
        }
    
        .chaosfanatic:before {
            content: url('img/rsp777/game_icon_chaosfanaticc81e.png?2');
        }
    
        .commanderzilyana:before {
            content: url('img/rsp777/game_icon_commanderzilyanac81e.png?2');
        }
    
        .corporealbeast:before {
            content: url('img/rsp777/game_icon_corporealbeastc81e.png?2');
        }
    
        .crazyarchaeologist:before {
            content: url('img/rsp777/game_icon_crazyarchaeologistc81e.png?2');
        }
    
        .dagannothprime:before {
            content: url('img/rsp777/game_icon_dagannothprimec81e.png?2');
        }
    
        .dagannothrex:before {
            content: url('img/rsp777/game_icon_dagannothrexc81e.png?2');
        }
    
        .dagannothsupreme:before {
            content: url('img/rsp777/game_icon_dagannothsupremec81e.png?2');
        }
    
        .derangedarchaeologist:before {
            content: url('img/rsp777/game_icon_derangedarchaeologistc81e.png?2');
        }
    
        .dukesucellus:before {
            content: url('img/rsp777/game_icon_dukesucellusc81e.png?2');
        }
    
        .generalgraardor:before {
            content: url('img/rsp777/game_icon_generalgraardorc81e.png?2');
        }
    
        .giantmole:before {
            content: url('img/rsp777/game_icon_giantmolec81e.png?2');
        }
    
        .grotesqueguardians:before {
            content: url('img/rsp777/game_icon_grotesqueguardiansc81e.png?2');
        }
    
        .hespori:before {
            content: url('img/rsp777/game_icon_hesporic81e.png?2');
        }
    
        .kalphitequeen:before {
            content: url('img/rsp777/game_icon_kalphitequeenc81e.png?2');
        }
    
        .kingblackdragon:before {
            content: url('img/rsp777/game_icon_kingblackdragonc81e.png?2');
        }
    
        .kraken:before {
            content: url('img/rsp777/game_icon_krakenc81e.png?2');
        }
    
        .kreearra:before {
            content: url('img/rsp777/game_icon_kreearrac81e.png?2');
        }
    
        .kriltsutsaroth:before {
            content: url('img/rsp777/game_icon_kriltsutsarothc81e.png?2');
        }
    
        .lunarchests:before {
            content: url('img/rsp777/game_icon_lunarchestsc81e.png?2');
        }
    
        .mimic:before {
            content: url('img/rsp777/game_icon_mimicc81e.png?2');
        }
    
        .nex:before {
            content: url('img/rsp777/game_icon_nexc81e.png?2');
        }
    
        .nightmare:before {
            content: url('img/rsp777/game_icon_nightmarec81e.png?2');
        }
    
        .phosanisnightmare:before {
            content: url('img/rsp777/game_icon_phosanisnightmarec81e.png?2');
        }
    
        .obor:before {
            content: url('img/rsp777/game_icon_oborc81e.png?2');
        }
    
        .phantommuspah:before {
            content: url('img/rsp777/game_icon_phantommuspahc81e.png?2');
        }
    
        .sarachnis:before {
            content: url('img/rsp777/game_icon_sarachnisc81e.png?2');
        }
    
        .scorpia:before {
            content: url('img/rsp777/game_icon_scorpiac81e.png?2');
        }
    
        .scurrius:before {
            content: url('img/rsp777/game_icon_scurriusc81e.png?2');
        }
    
        .skotizo:before {
            content: url('img/rsp777/game_icon_skotizoc81e.png?2');
        }
    
        .solheredit:before {
            content: url('img/rsp777/game_icon_solhereditc81e.png?2');
        }
    
        .spindel:before {
            content: url('img/rsp777/game_icon_spindelc81e.png?2');
        }
    
        .tempoross:before {
            content: url('img/rsp777/game_icon_temporossc81e.png?2');
        }
    
        .thegauntlet:before {
            content: url('img/rsp777/game_icon_thegauntletc81e.png?2');
        }
    
        .thecorruptedgauntlet:before {
            content: url('img/rsp777/game_icon_thecorruptedgauntletc81e.png?2');
        }
    
        .theleviathan:before {
            content: url('img/rsp777/game_icon_theleviathanc81e.png?2');
        }
    
        .thewhisperer:before {
            content: url('img/rsp777/game_icon_thewhispererc81e.png?2');
        }
    
        .theatreofblood:before {
            content: url('img/rsp777/game_icon_theatreofbloodc81e.png?2');
        }
    
        .theatreofbloodhardmode:before {
            content: url('img/rsp777/game_icon_theatreofbloodhardmodec81e.png?2');
        }
    
        .thermonuclearsmokedevil:before {
            content: url('img/rsp777/game_icon_thermonuclearsmokedevilc81e.png?2');
        }
    
        .tombsofamascut:before {
            content: url('img/rsp777/game_icon_tombsofamascutc81e.png?2');
        }
    
        .tombsofamascutexpertmode:before {
            content: url('img/rsp777/game_icon_tombsofamascutexpertmodec81e.png?2');
        }
    
        .tzkalzuk:before {
            content: url('img/rsp777/game_icon_tzkalzukc81e.png?2');
        }
    
        .tztokjad:before {
            content: url('img/rsp777/game_icon_tztokjadc81e.png?2');
        }
    
        .vardorvis:before {
            content: url('img/rsp777/game_icon_vardorvisc81e.png?2');
        }
    
        .venenatis:before {
            content: url('img/rsp777/game_icon_venenatisc81e.png?2');
        }
    
        .vetion:before {
            content: url('img/rsp777/game_icon_vetionc81e.png?2');
        }
    
        .vorkath:before {
            content: url('img/rsp777/game_icon_vorkathc81e.png?2');
        }
    
        .wintertodt:before {
            content: url('img/rsp777/game_icon_wintertodtc81e.png?2');
        }
    
        .zalcano:before {
            content: url('img/rsp777/game_icon_zalcanoc81e.png?2');
        }
    
        .zulrah:before {
            content: url('img/rsp777/game_icon_zulrahc81e.png?2');
        }
    
</style>
</head>
<body id="body">

<br>


<strong><img src="https://i.imgur.com/Y03remk.png" alt="pic" /></strong><br />

<br/>
<div align="center">

</nav>
<div class="personal-hiscores__table">
<div id="col2">
<div id="headerHiscores"></div>
<div class="hiscoresHiddenBG">
<div id="contentHiscores">
<table>
<caption>
<img class="miniimg"  src="img/rsp777/blank.gif" />
&nbsp;
Clog & Pet
Hiscores
</caption>
<thead>
<tr>

<th>Rank</th><th>Name</th><th>Clogs</th><th>	Change</th><th class="right">Pets</th>
</tr>
</thead>
<tbody id="hiscores-table">
            <!-- Data will be inserted here -->
        </tbody>
    </table>

    <div id="logs-container">
        <!-- Collection logs will be displayed here -->
    </div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBelYqDi1YKJ3PWpbzDRsvIBVlaUDTXtqI",
            authDomain: "clanhiscores.firebaseapp.com",
            projectId: "clanhiscores",
            storageBucket: "clanhiscores.firebasestorage.app",
            messagingSenderId: "101248585475",
            appId: "1:101248585475:web:a5e8a47276d226c22e2336"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const GROUP_ID = 5474; // Replace with your group ID
        const METRIC = "collections_logged";
        const PAGE_SIZE = 20; // Number of members per page
        const RATE_LIMIT_DELAY = 70000; // 70 seconds in milliseconds

        // Fetch data for a specific page
        async function fetchPage(page) {
            const url = `https://api.wiseoldman.net/v2/groups/${GROUP_ID}/hiscores?metric=${METRIC}&page=${page}&limit=${PAGE_SIZE}`;
            console.log(`Fetching page ${page} from API...`);  // Log fetch attempts
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            const data = await response.json();
            console.log(`Fetched page ${page}:`, data);  // Log the API response
            return data;
        }

        // Save data to Firestore with filtering for scores >= 500
        async function saveToFirestore(data) {
            const batch = [];

            // Filter out entries where the score is less than 500
            const filteredData = data.filter(entry => entry.data.score >= 500);
            console.log("Filtered Data (score >= 500):", filteredData);  // Log the filtered data

            filteredData.forEach((entry) => {
                // Remove the global rank field before saving to Firestore
                const { rank, ...entryWithoutRank } = entry.data;
                console.log("Saving valid entry:", entryWithoutRank);  // Log the entry being saved
                const playerRef = doc(db, "clanHiscores", entry.player.username);
                batch.push(setDoc(playerRef, { ...entry, data: entryWithoutRank }, { merge: true }));
            });

            await Promise.all(batch); // Commit all writes
            console.log("Data saved to Firestore!");
        }

        // Load data from Firestore and sort by score
        async function loadFromFirestore() {
            console.log("Loading data from Firestore...");
            const querySnapshot = await getDocs(collection(db, "clanHiscores"));
            const data = querySnapshot.docs.map(doc => doc.data());

            // Sort by score (descending order)
            data.sort((a, b) => b.data.score - a.data.score);

            console.log("Loaded data from Firestore:", data);
            return data;
        }

        // Display hiscores in the table
        function displayHiscores(data) {
            console.log("Displaying hiscores in table...");
            const tableBody = document.getElementById("hiscores-table");
            let tableRows = "";

            data.forEach((entry, index) => {
                const player = entry.player;
                const scoreData = entry.data;

                tableRows += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${player.username}</td>
                        <td>${scoreData.score}</td>
                    </tr>
                `;
            });

            tableBody.innerHTML = tableRows;
        }

        // Fetch new data and update Firestore
        async function fetchAndUpdateHiscores() {
            let allMembers = await loadFromFirestore();
            let page = Math.floor(allMembers.length / PAGE_SIZE) + 1;
            let hasMoreData = true;

            while (hasMoreData) {
                try {
                    console.log(`Fetching page ${page}...`);
                    const data = await fetchPage(page);
                    if (data.length > 0) {
                        allMembers = allMembers.concat(data);
                        await saveToFirestore(data); // Update Firestore
                        page++;
                    } else {
                        hasMoreData = false; // No more data
                    }
                } catch (error) {
                    console.error(`Error fetching page ${page}:`, error);
                    break;
                }

                // Respect the rate limiter
                if (hasMoreData) {
                    console.log(`Waiting ${RATE_LIMIT_DELAY / 1000} seconds before fetching the next page...`);
                    await new Promise(resolve => setTimeout(resolve, RATE_LIMIT_DELAY));
                }
            }

            return allMembers;
        }

        // Main function to load and display hiscores
        async function init() {
            try {
                console.log("Initializing hiscores...");
                // Hide loading message initially
                const loadingElement = document.getElementById("loading");
                loadingElement.style.display = "none";  // Hide loading right away

                // Load existing data from Firestore
                const storedData = await loadFromFirestore();
                console.log("Stored data from Firestore:", storedData);
                if (storedData.length > 0) {
                    displayHiscores(storedData); // Display stored data immediately
                }

                // Fetch new data and update the table
                const updatedData = await fetchAndUpdateHiscores();
                console.log("Updated data:", updatedData);
                displayHiscores(updatedData);

            } catch (error) {
                console.error("Error initializing hiscores:", error);
                document.getElementById("hiscores-table").innerHTML = `
                    <tr>
                        <td colspan="4">Failed to load data. Please try again later.</td>
                    </tr>
                `;
            } finally {
                // Hide the loading message if it's still visible
                const loadingElement = document.getElementById("loading");
                if (loadingElement.style.display !== "none") {
                    console.log("Hiding loading message...");
                    loadingElement.style.display = "none";  // Ensure loading is hidden
                }
            }
        }

        // Start the process
        window.addEventListener('load', () => {
            console.log('Page loaded, starting process...');
            init();  // Ensure init() is triggered only after the page is fully loaded
        });
    </script>
<script type="text/javascript" src="js/osrs/gtm-100.js" data-cookieconsent="ignore"></script>
</div> <script>(function(){if (!document.body) return;var js = "window['__CF$cv$params']={r:'88e89124deee77a0',t:'MTcxNzUxMDg2MS45ODAwMDA='};_cpo=document.createElement('script');_cpo.nonce='',_cpo.src='../cdn-cgi/challenge-platform/h/g/scripts/jsd/26ed7e9dda49/main.js',document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script></body>
</html>
